---
layout:    post
title:     "SQL 学习"
date:       2020-07-23
category:  Mysql
author:    iiwowks
published:     true
---

## 语言描述——BNF范式

* 方括号( [ ] )内包含的为可选项
* 大括号( { } )内包含的为可重复0至无数次的项
* 竖线( | )表示在其左右两边任选一项，相当于"OR"的意思
* 尖括号( < > )内包含的为必选项

## sql 通用数据类型

| 数据类型                           | 描述                                                         |
| :--------------------------------- | :----------------------------------------------------------- |
| CHARACTER(n)                       | 字符/字符串 ，固定长度 n                                     |
| VARCHAR(n) 或 CHARACTER VARYING(n) | 字符/字符串，可变长度，最大长度 n                            |
| BINARY(n)                          | 二进制串，固定长度 n                                         |
| BOOLEAN                            | 存储 TRUE 或 FALSE 值                                        |
| VARBINARY(n) 或 BINARY VARYING(n)  | 二进制串 可变长度  最大长度 n                                |
| INTEGER(p)                         | 整数值（没有小数点）精度 p                                   |
| SMALLINT                           | 整数值（没有小数点）精度 5                                   |
| INTEGER                            | 整数值（没有小数点）精度 10                                  |
| BIGINT                             | 整数值（没有小数点）精度 19                                  |
| DECIMAL(p,s)                       | 精确数值，精度 p，小数点后位数 s例如：decimal(5,2) 是一个小数点前有 3 位数小数点后有 2 位数的数字 |
| NUMERIC(p,s)                       | 精确数值，精度 p，小数点后位数 s（与 DECIMAL 相同）          |
| FLOAT(p)                           | 近似数值，尾数精度 p。一个采用以 10 为基数的指数计数法的浮点数。该类型的 size 参数由一个指定最小精度的单一数字组成 |
| REAL                               | 近似数值，尾数精度 7                                         |
| FLOAT                              | 近似数值，尾数精度 16                                        |
| DOUBLE PRECISION                   | 近似数值，尾数精度 16                                        |
| DATE                               | 存储年、月、日的值                                           |
| TIME                               | 存储小时、分、秒的值                                         |
| TIMESTAMP                          | 存储年、月、日、小时、分、秒的值                             |
| INTERVAL                           | 由一些整数字段组成，代表一段时间，取决于区间的类型。         |
| ARRAY                              | 元素的固定长度的有序集合                                     |
| MULTISET                           | 元素的可变长度的无序集合                                     |
| XML                                | 存储 XML 数据                                                |

## as

```sql
select column_name as column_alias
from table_name;
```

## auto-increment

Auto-increment 会在新记录插入表中时生成一个唯一的数字,自动创建主键值,
auto-increment起始值为1，增1

```sql
CREATE TABLE Persons
(
ID int NOT NULL AUTO_INCREMENT=100,
LastName varchar(255) NOT NULL,
FirstName varchar(255),
Address varchar(255),
City varchar(255),
PRIMARY KEY (ID)
```

## and or not

```sql
select column1, column2,
from table_name
where [not] [condition1] [and [or]] [condition2]...
```

## alter table

> ALTER TABLE 语句用于在现有表中添加、删除或修改列。

```sql
alter table table_name {ADD|DROP|MODIFY} column_name {data_ype};
```

>对表名重命名

```sql
alter table table_name rename to new_table_name;
```

## between

```sql
select clumn_name(s)
from table_name
where column_name [not] between value1 and value2;
```

* between运算符具有包括性，包含value1, value2

## create database

```sql
create database database_name;
```

## create table

```sql
create table table_name(
    column1 datatype,
    column2 datatype,
    column3 datatype,
    ....
    columnN datatype,
    primary key(one or more columns)
);
```

## create index

```sql
create unique index index_name
on table_name ( column1, column2,...columnN);
```

## commit

```sql
COMMIT;
```

## delete

```sql
delete [*] from table_name
where condition;
```

## drop

通过使用 DROP 语句，可以轻松地删除索引、表和数据库

## drop table

```sql
drop table table_name;
```

## drop index

```sql
alter table table_name
drop index index_name;
```

## desc

```sql
desc table_name;
```

## except

用于组合两个SELECT语句，并返回第一个SELECT语句中没有由第二个SELECT语句返回的行

## select

```sql
select columns1, column2, ...
from table_name;
```

## select into

```sql
select column_name(s)
into newtable [IN externaldb]
from tabel1;
```

可以将信息从一个表中复制到另一个表中,SELECT INTO 语句从一个表中复制数据，然后将数据插入到另一个新表中

## select where

```sql
select column1, column2, ...
from table_name
where condition;
```

## select top  limit  rownum

```sql
# SQL server
SELECT TOP number|percent column_name(s)
FROM table_name
WHERE condition;

# mysql
select column_name(s)
from table_name
where condition
limit number;

# oracle
select * from table_name
where rownum <= number;
```

## having

```sql
select SUM(column_name)
from   table_name
where  condition
group by column_name
having (arithematic function condition);
```

## insert into

```sql
insert into table_name (column1, column2, ...)
values (value1, value2, value3, ...);

insert into table_name
values (value1, value2, value3, ...);
```

## intersect

用于组合两个SELECT语句，但只返回与第二个SELECT语句中的一行相同的第一个SELECT语句中的行

## in

```sql
select column_name(s)
from table_name
where column_name in (value1, value2, ...);
```

* IN运算符允许您在WHERE子句中指定多个值。
* IN运算符是多个OR条件的简写。

## insert into select

```sql
insert into table2
(column_name(s))
select culumn_name(s)
from table1;
```

INSERT INTO SELECT 语句从表中复制数据，并将数据插入现有的表中。目标表中的任何现有行都不会受到影响

## order by

```sql
select column1, column2, ...
from table_name
order by column1, column2, ... ASC|DESC;
```

## null

```sql
select column_names
from table_name
where column_name is [not] null;
```

## update

```sql
update table_name
set column1=value1, column2=value2, ...
where condition;
```

## 运算符

* `<>`:检查两个操作数的值是否相等，如果值**不相等**则条件为真(true)
* (a <> b) is true

## 表达式

```sql
select column1, column2, columnN
from table_name
where [condition|EXPRESSION];
```

>布尔表达式

```sql
select column1, column2, columnN
from table_name
where SINGLE value MATCHING EXPRESSION;
```

>数值表达式

```sql
select numerical_expression as  OPERATION_NAME
[from table_name
where CONDITION] ;
```

>日期表达式

```sql
select CURRENT_TIMESTAMP;
```

## use

```sql
use database_name;
```

## like

```sql
select column1, column2, ...
from table_name
where columnN like pattern;
```

在WHERE子句中使用LIKE运算符来搜索列中的指定模式。

* `％` - 百分号表示零个，一个或多个字符
* `_` - 下划线表示单个字符

## wildcards通配符

```sql
select * from table_name
where column like 'b_er%';
```

> [charlist]通配符，选择以'a','b','c'开头的column

```sql
select * from table_name
where column like '[a-c]%';
```

　有两个通配符与LIKE运算符一起使用：

* `％` - 百分号表示零个，一个或多个字符
* `_` - 下划线表示单个字符
* `[charlist]` - 定义要匹配的字符的集合和范围
* `[^charlist]`或`[!charlist]` - 定义不匹配字符的集合和范围

## truncate

截断表语句

```sql
truncate table table_name;
```

## rollback

```sql
ROLLBACK;
```

## 连接join

<aside class = "warning">
重点!
</aside>

### 不同的sql join

* **INNER JOIN**：如果表中有至少一个匹配，则返回行
* **LEFT JOIN**：即使右表中没有匹配，也从左表返回所有的行
* **RIGHT JOIN**：即使左表中没有匹配，也从右表返回所有的行
* **FULL JOIN**：只要其中一个表中存在匹配，则返回行
* **SELF JOIN**：用于将表连接到自己，就好像该表是两个表一样，临时重命名了SQL语句中的至少一个表
* **CARTESIAN JOIN**：从两个或多个连接表返回记录集的笛卡儿积

## inner join

```sql
select column_name(s)
from table1
inner join table2 on table1.column_name = table2.column_name;
```

* 选择两个表中具有匹配项的记录

![image0](https://atts.w3cschool.cn/attachments/day_160815/201608151946162952.gif)

## left join

```sql
select column_name(s)
from table1
left join table2 on table1.column_name = table2.column_name;
```

　SQL左链接LEFT JOIN关键字返回左表（表1）中的所有行，即使在右表（表2）中没有匹配

![201608151944346042.gif](../images/mysql/201608151944346042.gif)

## right join

```sql
select column_name(s)
from table1
right join table2 on table1.column_name = table2.column_name;
```

　SQL右链接 RIGHT JOIN 关键字返回右表（table2）的所有行，即使在左表（table1）上没有匹配。如果左表没有匹配，则结果为NULL。

![image](../images/mysql/201608151944076968.gif)

## full outer join

```sql
select column_name(s)
from table1
full outer join table2 on table1.column_name = table2.column_name;
```

当左（表1）或右（表2）表记录匹配时，full outer join关键字将返回所有记录。

>注意：** FULL OUTER JOIN可能会返回非常大的结果集！

![imgage](../images/mysql/201608151947092720.gif)

## self join

```sql
select column_name(s)
from table1 T1, table1 T2
where condition;
```

>自联接是一种常规联接，但表本身是连接的。

## union

> 注释：默认情况下，UNION 运算符选择一个不同的值。如果允许重复值，请使用 UNION ALL。

```sql
select column_name(s) from table1
[where condition]
union
select column_name(s) from table2
[where condition];
```

UNION运算符用于组合两个或更多SELECT语句的结果集，而不返回任何重复的行:

* UNION中的每个SELECT语句必须具有相同的列数
* 这些列也必须具有相似的数据类型
* 每个SELECT语句中的列也必须以相同的顺序排列
* 每个SELECT语句必须有相同数目的列表达式
* 但是每个SELECT语句的长度不必相同

> UNION All运算符用于组合两个SELECT语句(包括重复行)的结果。

```sql
select column_name(s) from table1
[where condition]
union all
select column_name(s) from table2
[where condition];
```

## truncate table

```sql
truncate table table_name;
```

只删除表中的数据不删除表中的内容

## 视图

视图是基于sql语句结果集的可视化表

> create view

```sql
create view view_name as
select column_name(s)
from table_name
where condition;
```

> create or replace view更新视图

```sql
create or replace view view_name as
select column_name(s)
from table_name
where condition;
```

> drop view删除视图

```sql
drop view_name;
```

## data函数

MySQL 中最重要的内置日期函数：

| 函数                                                         | 描述                                |
| :----------------------------------------------------------- | :---------------------------------- |
| [NOW()](https://www.w3cschool.cn/mysql/func-now.html)        | 返回当前的日期和时间                |
| [CURDATE()](https://www.w3cschool.cn/mysql/func-curdate.html) | 返回当前的日期                      |
| [CURTIME()](https://www.w3cschool.cn/mysql/func-curtime.html) | 返回当前的时间                      |
| [DATE()](https://www.w3cschool.cn/mysql/func-date.html)      | 提取日期或日期/时间表达式的日期部分 |
| [EXTRACT()](https://www.w3cschool.cn/mysql/func-extract.html) | 返回日期/时间的单独部分             |
| [DATE_ADD()](https://www.w3cschool.cn/mysql/func-date-add.html) | 向日期添加指定的时间间隔            |
| [DATE_SUB()](https://www.w3cschool.cn/mysql/func-date-sub.html) | 从日期减去指定的时间间隔            |
| [DATEDIFF()](https://www.w3cschool.cn/mysql/func-datediff-mysql.html) | 返回两个日期之间的天数              |
| [DATE_FORMAT()](https://www.w3cschool.cn/mysql/func-date-format.html) | 用不同的格式显示日期/时间           |

MySQL 使用下列数据类型在数据库中存储日期或时间值：

* DATE - 格式：YYYY-MM-DD
* DATETIME - 格式：YYYY-MM-DD HH:MM:SS
* TIMESTAMP - 格式：YYYY-MM-DD HH:MM:SS
* YEAR - 格式：YYYY 或 YY
